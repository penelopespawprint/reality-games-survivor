# Railway nixpacks configuration
# IMPORTANT: You MUST set Service Root Directory to "/server" in Railway dashboard
# Go to: Railway Dashboard → Service → Settings → Root Directory → Set to "/server"

[phases.setup]
nixPkgs = ["nodejs_20"]

[phases.install]
cmds = ["cd server && npm ci --include=dev"]

[phases.build]
cmds = [
  "cd server && npm run build",
  "cd server && ls -la dist/ || (echo 'ERROR: dist directory not found' && exit 1)",
  "cd server && test -f dist/server.js || (echo 'ERROR: server.js not found after build' && exit 1)",
  "echo '✓ Build successful: dist/server.js exists'"
]

[start]
cmd = "cd /app/server && node dist/server.js"
