# Railway builds from repo root
[phases.setup]
nixPkgs = ["nodejs_20"]

[phases.install]
cmds = [
  "echo '=== Installing dependencies ==='",
  "cd server && npm ci --include=dev",
  "cd server && npm list typescript"
]

[phases.build]
cmds = [
  "echo '=== Starting TypeScript build ==='",
  "cd server && npx tsc --version",
  "cd server && npx tsc",
  "echo '=== Build complete, checking output ==='",
  "ls -la server/dist/",
  "test -f server/dist/server.js || (echo 'ERROR: server.js not found!' && exit 1)"
]

[start]
cmd = "cd server && node dist/server.js"
