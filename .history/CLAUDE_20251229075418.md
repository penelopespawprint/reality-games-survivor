# Survivor Fantasy League

**Last Updated:** Dec 29, 2025 | **Version:** 1.0.0 | **Status:** Production

## Quick Reference (Read This First)
- **Tech Stack:** React + Vite + Tailwind | Express + TypeScript | PostgreSQL
- **Database:** Supabase (PostgreSQL + Auth + Realtime)
- **Deployment:** Railway (API) | Railway (Web) | Supabase (DB)
- **Critical Commands:**
  ```bash
  cd server && npm run dev     # Start API
  cd web && npm run dev        # Start frontend
  cd server && railway up      # Deploy API
  ```

---

## Current Context (Update Weekly)
**Working On:** Season 50 launch preparation
**Blocked By:** None
**Next Up:** User testing, marketing push
**Known Issues:** None critical

---

## Project Structure
```
/server         # Express API backend
/web            # React frontend (Vite)
/supabase       # Migrations and types
/docs           # Documentation
```

**Key Files:**
- `server/src/server.ts` - API entry point
- `server/src/routes/` - All API routes (modular structure)
- `web/src/pages/` - React pages
- `web/src/lib/hooks/` - Shared React Query hooks
- `web/src/types/index.ts` - ALL TypeScript types

---

## Common Tasks

### Start Development
```bash
cd server && npm run dev  # Terminal 1
cd web && npm run dev     # Terminal 2
```

### Deploy API
```bash
cd server && railway up --detach
```

### Run Database Migration
```bash
npx supabase db push
```

### Generate Types from DB
```bash
npx supabase gen types typescript --project-id qxrgejdfxcvsfktgysop > supabase/types.ts
```

---

## Critical Constraints
- ‚ùå Never write direct Supabase mutations in frontend for sensitive ops (use API)
- ‚ùå Never store passwords in plaintext (use bcrypt on backend)
- ‚ö†Ô∏è Always use `apiWithAuth()` for authenticated API calls
- ‚ö†Ô∏è Always import types from `@/types` (never define inline)
- ‚ö†Ô∏è Always use shared hooks from `@/lib/hooks` (never inline queries)
- üí° Prefer extracting components when files exceed 400 lines
- üí° Prefer PST/PDT timezone handling with Luxon

---

## Environment Variables

**Server Required:**
- `SUPABASE_URL` - Supabase project URL
- `SUPABASE_SERVICE_ROLE_KEY` - Admin access key
- `STRIPE_SECRET_KEY` - Stripe payments
- `RESEND_API_KEY` - Email service
- `TWILIO_*` - SMS service credentials

**Web Required:**
- `VITE_SUPABASE_URL` - Supabase project URL
- `VITE_SUPABASE_ANON_KEY` - Public anon key
- `VITE_API_URL` - Backend API URL

---

## Architecture Decisions
**Database:** Supabase PostgreSQL - RLS for security, Realtime for live updates
**Auth:** Supabase Auth - Google OAuth + Magic Link, JWT tokens
**State Management:** React Query - Server state caching, automatic refetch
**Styling:** Tailwind CSS - Utility-first, consistent design system

---

## Common Pitfalls
1. **Problem:** Query key mismatch between hooks ‚Üí **Solution:** Always use hooks from `@/lib/hooks`
2. **Problem:** Timezone bugs with episode times ‚Üí **Solution:** Use Luxon, all times in PST
3. **Problem:** Admin routes accessible without auth ‚Üí **Solution:** All admin ops go through `/api/admin/*` with role check
4. **Problem:** Roster shows dropped castaways ‚Üí **Solution:** Filter `.is('dropped_at', null)`

---

## External Dependencies
- Supabase - Database + Auth ([docs](https://supabase.com/docs))
- Stripe - Payments ([docs](https://stripe.com/docs))
- Resend - Transactional email ([docs](https://resend.com/docs))
- Twilio - SMS ([docs](https://www.twilio.com/docs))
- Railway - Hosting ([docs](https://docs.railway.app))

---

## Testing Strategy
**Unit Tests:** `npm test` (Jest)
**Integration:** Manual API testing via curl/Postman
**E2E:** Browser testing via MCP browser tools

---

## Deployment Checklist
- [ ] Run `npm run build` in both `/server` and `/web`
- [ ] Check for TypeScript errors
- [ ] Verify environment variables in Railway
- [ ] Deploy: `cd server && railway up --detach`
- [ ] Verify health check: `curl https://rgfl-api-production.up.railway.app/health`

---

## Resources
- [Cursor Rules](.cursor/rules/survivor-rules.mdc) - Detailed project rules
- [API Health](https://rgfl-api-production.up.railway.app/health)
- [Production Site](https://survivor.realitygamesfantasyleague.com)
- [Supabase Dashboard](https://supabase.com/dashboard/project/qxrgejdfxcvsfktgysop)

---

## Game Rules Summary
| Rule | Value |
|------|-------|
| Roster Size | 2 castaways (fixed all season) |
| Weekly Pick | 1 from your roster, locks Wed 3pm PST |
| Draft | After Episode 1, snake draft from rankings |
| Elimination | Both castaways out = torch snuffed |
| Results | Released Friday 2pm PST (spoiler-safe) |

---

## Key Dates (Season 50)
| Event | Date |
|-------|------|
| Registration Opens | Dec 19, 2025 |
| Premiere | Feb 25, 2026 |
| Draft Deadline | Mar 2, 2026 |
| Finale | May 27, 2026 |
